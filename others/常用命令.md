---
title: "常用命令"
date: 2021-05-31T16:07:09+08:00
description: ""
draft: true
tags: []
categories: []
---

### 磁盘清理

for i in ` find /home/work/logs/neo-logs -type f -size +100M ` ;do echo $i; > $i;done

supervisorctl restart logcollect #不是必须

for i in `docker image ls |grep "months ago" |awk '{print $3}'`; do docker image rm $i;done  #镜像清理

### 根据pid获取服务树

/usr/local/bin/hids.sh procinfo 15021

### 常用机器

c4-b2c-b2cop-console02.bj 自己用跳板机

c3-b2c-b2cop-download02 文件下载服务器

### 根据pid查找容器

/usr/local/bin/hids.sh procinfo

### 删除cron文件夹

cd /home/work/logs/neo-logs/ && for i in `ls -l |grep cron |awk '{print $9}'`;do echo $i ;rm -rf $i;done

cd /home/work/logs/neo-logs-bak/ && for i in `ls -l |grep cron |awk '{print $9}'`;do echo $i ;rm -rf $i;done

### 批量加key

for i in `cat ip`;do hd $i "ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa";done

for i in `cat ip`;do hd $i "echo 'ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA0+2PQp7wSLPocujLffkp91gOSCM9xP7VTFwbviP/FFJZzpWCbMkppAAh3GH30UxLBrreXSWmepPw+R9ntWf0MIRQScKLxO1OPIVCEyyrpo36eMIF9zNJDt9XQZEL0TtNWDkKp/VTypA1OLtUNZSL8fP3g8a5VFq0nWnSCgyHKyYyXTI6Ed+y7Qt7OqhTpnaZwQ5bRbgC/ZdmzAmatMuzzcHueJ0H1h1g8BeYIXn+7Sti49y5sm2IYGGS4aigbz4UfRrg+CXZZ/24EZTefRFADB20SY3Gsjpom98kNy8tIzsESU4awgkCxfKM/+23Qen0sZvjWihECdchCGsQwNQsHw== root@console-78' >> ~/.ssh/authorized_keys";done

### 查找容器对半网卡

进入容器执行

id=$(cat /sys/class/net/eth0/iflink) #这里获取了一个id号

宿主机执行

ip a |grep $id #这里可以找到

### 进入容器的网络空间抓包

docker ps |grep demo-d49ozbhq |grep -v pause

docker inspect b8f |grep Pid

nsenter -t29656 -n

tcpdump

### cni0网卡清理

ifconfig cni0 down

ip link delete cni0

### 磁盘坏道检测

megacli -pdlist -a0|egrep "Slot Number|Firmware state|Media Error|Other Error|Predictive Failure Count"

### [c3-b2c-b2cop-chaos-node0x.bj](http://c3-b2c-b2cop-chaos-node0x.bj)主机磁盘满

find /home/work/data/hera/deploy -maxdepth 1 -ctime +30 -type d -exec rm -rf {} \;

supervisorctl restart filebeat

### sock排序

lsof |grep sock |awk '{print $2}' |sort -nr |uniq -c |sort -nr |less